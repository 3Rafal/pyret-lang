<style> /* set the CSS */
.chart div {
  font: 10px sans-serif;
  background-color: steelblue;
  text-align: right;
  padding: 3px;
  margin: 1px;
  color: white;
}
</style>
<body>
<h3> 
Bar lengths are normalized against the performance of the empty program. Longer bars are better!
</h3>
<div class="chart-container">

</div>

<!-- load the d3.js library -->    
<script src="d3.v3.min.js"></script>

<script>

// Get the data
d3.csv('auto-report.build10.csv', function (error, data) {
    

    data = data.filter(function (datum) { return datum.success === 'true'; });
    var names = data.map(function (datum) { return datum.name; });

    if (names.length % 3 !== 0) {
        throw new Error('Corrupted CSV data!');
    }

    var i = 0;
    var names_set = new Array(names.length/3);
    while (i < names.length) {
       names_set[i/3] = names[i];
       i = i + 3;
    }

    i = 0;
    chart_data = new Array(names_set.length);
    while (i < names_set.length) {
        splice = data.filter(function (datum) { return datum.name === names_set[i]; });
        chart_data[i] = splice.map(function (datum) { return datum.hz; });
        i = i + 1;
    }


    var gold_name = '0_empty.arr';
    var gold_splice = data.filter(function (datum) { return datum.name === gold_name; });
    var gold_standard = gold_splice.map(function (datum) { return datum.hz; });

    var test = [556, 1, 150];

    // i = 0;
    // while (i < test.length) {
    //   test[i] = (100 * test[i]) / gold_standard[i];
    //   i = i + 1;
    // }

    d3.select('.chart-container')
      .selectAll('div')
        .data(names_set)
      .enter().append('div')
        .text(function (d) { return d; })
        .attr('class', 'chart')
        .attr('id', function (d) { return d; });
      // .selectAll('div')
      //   .data(test)
      // .enter().append('div')
      //   .style('width', function (d, i) { return 500 * d / gold_standard[i] + 'px'; })

    d3.selectAll('.chart')
      .data(chart_data)
      .each(function (d) {
        // d is an array
        console.log(this, d);
        d3.select(this)
        .selectAll('div')
        .data(d)
        .enter().append('div')
        //.style('width', function () {return '100px';});
        .style('width', function (dd, ii) { console.log('style', dd, ii); return 500 * dd / gold_standard[ii] + 'px'; });
      })

    labels = ['parse', 'load', 'eval'];
    d3.selectAll('.chart')
    .each(function () {
      d3.select(this)
      .selectAll('div')
      .data(labels)
      .text(function (d) { return d; })
    });
      

    i = 0
});


</script>
</body>
