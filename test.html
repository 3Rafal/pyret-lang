<html>
<head>
<script src="node_modules/requirejs/require.js"></script>
<script>
  window.module = {};
  window.exports = {};
</script>

<script>
function loadModules(array,callback){
  var loader = function(moduleName, src, handler){
    var script = document.createElement("script");
    script.src = src;
    // want all of these to be loaded before executing the next script tag which has our
    // program
    script.async = false;
    script.onload = script.onreadystatechange = function(){
      script.onreadystatechange = script.onload = null;
      console.log("Loaded " + moduleName);
      var moduleVal = window.module.exports;
      define(moduleName, [], function() {
        return moduleVal;
      });
      handler();
    }
    var head = document.getElementsByTagName("head")[0];
    head.appendChild(script);
  };
  function run(){
    if(array.length!=0){
      var elem = array.shift();
      loader(elem["name"], elem["src"], run);
    }else{
      callback();
    }
  };
  run();
};

loadModules([{name: "s-expression", "src": "node_modules/s-expression/index.js"},
             {name: "seedrandom", "src": "node_modules/seedrandom/seedrandom.js"},
             {name: "source-map", "src": "node_modules/source-map/dist/source-map.js"},
             {name: "q", src: "node_modules/q/q.js"}],
            function(){
                console.log('Done loading');
            });

</script>
</head>
<script>
window.process = {
  stdout: {write: function(s) { console.log(s); } },
  stderr: {write: function(s) { console.error(s); } },
  argv: [],
  exit: function(err) {
      if (err != 0) {
          throw new Error("Program ending with signal: ", err);
      }
  }
}
</script>
<script type="text/javascript" src="test-file.jarr"></script>

</html>
