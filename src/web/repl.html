<html>
<head>
  <script src="../../node_modules/lodash/lodash.js"></script>
  <script src="../../node_modules/requirejs/require.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="../../lib/CodeMirror/lib/codemirror.js"></script>
  <script src="../../lib/CodeMirror/addon/fold/foldcode.js"></script>
  <script src="../../lib/CodeMirror/addon/fold/foldgutter.js"></script>
  <script src="../../lib/CodeMirror/addon/fold/indent-fold.js"></script>
  <script src="../../lib/CodeMirror/mode/pyret/pyret.js"></script>
  <link rel="stylesheet" href="../../lib/CodeMirror/lib/codemirror.css"></link>
  <script src="editor.js"></script>
  <script src="draw.js"></script>
  <link rel="stylesheet" href="reset.css"></link>
  <link rel="stylesheet" href="editor.css"></link>
</head>
<body>
<div id="loader"><p>Raising the masts...</p></div>
<div id="REPL" class="replContainer"></div>
</body>

<script>
LOG = true;
function ct_log(/* varargs */) {
  if (window.console && LOG) {
    console.log.apply(console, arguments);
  }
}
function ct_error(/* varargs */) {
  if (window.console && LOG) {
    console.error.apply(console, arguments);
  }
}
$(function() {
  var texts = [
      "Raising the masts...",
      "Securing the oarlocks...",
      "Hoisting the anchor...",
      "Swabbing the decks...",
      "Debarnacling the keel...",
      "Checking the cargo manifest...",
      "Assembling the crew...",
      "Inspecting the turnbuckles...",
      "Furling the rollers...",
      "Lashing the jib-boom..."
    ];
  $("#loader p").text(texts[Math.floor(Math.random() * texts.length)]);
  requirejs.config({
    paths: {
      "js": "../../build/phase1/js",
      "compiler": "../../build/phase1/arr/compiler",
      "trove": "../../build/phase1/trove",
      "q": "../../node_modules/q/q",
      "fs": "fsstub"
    },
    waitSeconds: 0
  });
  require(["js/repl-lib", "./repl-ui", "js/runtime-anf", "js/dialects-lib"], function(replLib, replUI, rtLib, dialectLib) {
    $("#loader").hide();
    var replContainer = $("<div>").addClass("repl");
    $("#REPL").append(replContainer);
    var runtime = rtLib.makeRuntime({stdout: function(str) { console.log(str); } });
    var dialects = dialectLib(runtime, runtime.namespace);
    var dialect = "Bootstrap"; // TODO: CHANGE THIS AS NEEDED
    var replNS = dialects.dialects[dialect].makeNamespace(runtime);
    var replEnv = dialects.dialects[dialect].compileEnv;
    var repl = replLib.create(dialect, runtime, replNS, replEnv);
    var codeRunner = replUI.makeRepl(replContainer, repl, runtime);
    window.RUN_CODE = function(src, uiOpts, replOpts) {
      codeRunner(src, uiOpts, replOpts);
    };
    var codeContainer = $("<div>").addClass("replMain");
    $(document.body).prepend(codeContainer);
    var cm = replUI.makeEditor(codeContainer, {
        simpleEditor: false,
        initial: "print('Ahoy, world!')",
        run: RUN_CODE,
        initialGas: 500
      });
  });
});
</script>
</html>

